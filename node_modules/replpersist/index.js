require("./prototypes.js"),req=require("./request.js"),fs=require("fs"),proc=require("child_process");var base=process.env.REPLIT_DB_URL;function runSync(js){fs.writeFileSync("../databaseTempSync.js",js);var result=proc.spawnSync("node",["../databaseTempSync.js"]),err=result.stderr.toString(),out;if(err)throw new Error(err);return result.stdout.toString().slice(0,-1)}function Database(key,delay,defa){if(delay&&"number"!=typeof delay)throw new Error(`${delay} is not a number!`);if(databases[key])throw new Error(`You can only create one database named ${key}!`);let self=this;this.defa=defa||[],this.name=key,this.data=[],this.lastBackup="",this.delay=delay||2,this.getSync=function(){var js;return runSync(`\n        http = require("https")\n        req = function(url){\n        if(url.match('http\\:')){\n          http = require('http')\n        }\n          http.get(url,function(res){\n            var body = ""\n            res.on("data", function(data){\n              body += data\n            })\n            res.on("end",function(){\n          console.log(body);  \n          })\n            })\n          }\n  req("${base}/${key}")\n  `)},this.functions={get:async function(){return await req.request(base+"/"+key)},set:async function(data){var formData=`${key}=${encodeURIComponent(data)}`,reqd={url:base,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},data:formData};return await req.form(base,formData,reqd)},list:async function(){return await req.request(base+"?prefix=")},del:async function(){return await req.request(base+"/"+key,"DELETE")}};var data=this.getSync();data||(data=JSON.stringify(self.defa)),self.data=JSON.parse(data),self.lastBackup=data,databases[self.name]=self,this.upload=function(){self.functions.set(JSON.stringify(self.data)),self.onupload&&self.onupload(self.data)},this.reset=this.functions.del,setInterval((function(){self.lastBackup!=JSON.stringify(self.data)&&(self.upload(),self.lastBackup=JSON.stringify(self.data))}),6e4*self.delay)}databases={},Database.databases=databases,module.exports=Database;